<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="In this section, we will explore the process of importing a precipitation radar map into our app using OpenWeatherMap and Leaflet. OpenWeatherMap offers the Weather maps API (https:&#x2F;&#x2F;openweathermap.or">
<meta property="og:type" content="article">
<meta property="og:title" content="Build a mini weather web with React - 0x04">
<meta property="og:url" content="http://huyhi.github.io/2023/react-weather-04/index.html">
<meta property="og:site_name" content="Hongye&#39;s Blog">
<meta property="og:description" content="In this section, we will explore the process of importing a precipitation radar map into our app using OpenWeatherMap and Leaflet. OpenWeatherMap offers the Weather maps API (https:&#x2F;&#x2F;openweathermap.or">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://huyhi.github.io/images/2023/react-weather-04/01.png">
<meta property="og:image" content="http://huyhi.github.io/images/2023/react-weather-04/02.png">
<meta property="article:published_time" content="2023-02-19T01:58:02.000Z">
<meta property="article:modified_time" content="2023-07-09T11:38:05.543Z">
<meta property="article:author" content="Hongye An">
<meta property="article:tag" content="gis">
<meta property="article:tag" content="frontend">
<meta property="article:tag" content="React">
<meta property="article:tag" content="Leaflet">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://huyhi.github.io/images/2023/react-weather-04/01.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>Build a mini weather web with React - 0x04</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/tags/">Tags</a></li><!--
     --><!--
       --><li><a href="/about/">About me</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" aria-label="Next post" href="/2023/react-weather-03/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://huyhi.github.io/2023/react-weather-04/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://huyhi.github.io/2023/react-weather-04/&text=Build a mini weather web with React - 0x04"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://huyhi.github.io/2023/react-weather-04/&title=Build a mini weather web with React - 0x04"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://huyhi.github.io/2023/react-weather-04/&is_video=false&description=Build a mini weather web with React - 0x04"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Build a mini weather web with React - 0x04&body=Check out this article: http://huyhi.github.io/2023/react-weather-04/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://huyhi.github.io/2023/react-weather-04/&title=Build a mini weather web with React - 0x04"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://huyhi.github.io/2023/react-weather-04/&title=Build a mini weather web with React - 0x04"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://huyhi.github.io/2023/react-weather-04/&title=Build a mini weather web with React - 0x04"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://huyhi.github.io/2023/react-weather-04/&title=Build a mini weather web with React - 0x04"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://huyhi.github.io/2023/react-weather-04/&name=Build a mini weather web with React - 0x04&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://huyhi.github.io/2023/react-weather-04/&t=Build a mini weather web with React - 0x04"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      
    </div>
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        Build a mini weather web with React - 0x04
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">Hongye An</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2023-02-19T01:58:02.000Z" class="dt-published" itemprop="datePublished">2023-02-19</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/Leaflet/" rel="tag">Leaflet</a>, <a class="p-category" href="/tags/React/" rel="tag">React</a>, <a class="p-category" href="/tags/frontend/" rel="tag">frontend</a>, <a class="p-category" href="/tags/gis/" rel="tag">gis</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <p>In this section, we will explore the process of importing a precipitation radar map into our app using OpenWeatherMap and Leaflet.</p>
<p>OpenWeatherMap offers the Weather maps API (<a target="_blank" rel="noopener" href="https://openweathermap.org/api/weathermaps">https://openweathermap.org/api/weathermaps</a>) for unpaid users. This API accepts various parameters and returns a PNG image. Our objective is to combine this image with our map.</p>
<p><a target="_blank" rel="noopener" href="https://leafletjs.com/">Leaflet</a>, on the other hand, is a powerful open-source JavaScript library specifically designed for creating interactive maps. With Leaflet, we can render map displays, add markers or widgets to the map, incorporate additional layers, and more. This capability allows us to easily integrate the precipitation layer onto our map.</p>
<p>Back to the code, we need to install the Leaflet dependencies by using the npm install command. Since we are working with React.js, we could use <a target="_blank" rel="noopener" href="https://react-leaflet.js.org/">React-Leaflet</a> into our project. React-Leaflet is a third-party library that builds upon Leaflet by providing a convenient wrapper and a collection of React components that can be used directly.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install leaflet react-leaflet</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">MapContainer</span>, <span class="title class_">TileLayer</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-leaflet&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./weather-map.css&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;leaflet/dist/leaflet.css&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">WeatherMap</span>(<span class="params"></span>) &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> position = [<span class="number">50.905</span>, <span class="number">6.500</span>]</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="comment">// we have to define height attribute for the map-container in css style, otherwise the map won&#x27;t display correctly </span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;map-container&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">MapContainer</span> <span class="attr">id</span>=<span class="string">&#x27;map&#x27;</span> <span class="attr">center</span>=<span class="string">&#123;position&#125;</span> <span class="attr">zoom</span>=<span class="string">&#123;4&#125;</span> <span class="attr">scrollWheelZoom</span>=<span class="string">&#123;false&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">TileLayer</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">attribution</span>=<span class="string">&#x27;<span class="symbol">&amp;copy;</span> &lt;a href=&quot;https://www.openstreetmap.org/copyright&quot;&gt;OpenStreetMap&lt;/a&gt; contributors&#x27;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">url</span>=<span class="string">&quot;https://&#123;s&#125;.tile.openstreetmap.org/&#123;z&#125;/&#123;x&#125;/&#123;y&#125;.png&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">TileLayer</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">url</span>=<span class="string">&#123;</span>`<span class="attr">https:</span>//<span class="attr">tile.openweathermap.org</span>/<span class="attr">map</span>/<span class="attr">precipitation_new</span>/&#123;<span class="attr">z</span>&#125;/&#123;<span class="attr">x</span>&#125;/&#123;<span class="attr">y</span>&#125;<span class="attr">.png</span>?<span class="attr">appid</span>=&lt;<span class="attr">Your</span> <span class="attr">OpenWeatherMap</span> <span class="attr">Map</span> <span class="attr">Key</span>&gt;</span>`&#125;</span></span><br><span class="line"><span class="language-xml">        /&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">MapContainer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  )</span></span><br><span class="line"><span class="language-xml">&#125;</span></span><br></pre></td></tr></table></figure>

<p>In our code, we can create a <code>WeatherMap</code> component. Within this component, we only need to include a <code>MapContainer</code> component provided by <code>react-leaflet</code>. Within the <code>MapContainer</code>, we can add two <code>TileLayer</code> components. The first <code>TileLayer</code> represents the basic map layer, which is provided by <a target="_blank" rel="noopener" href="https://www.openstreetmap.org/about">OpenStreetMap</a>. The second TileLayer represents the precipitation forecast map, which is obtained from the OpenWeatherMap API. When we run the code, the browser will display the precipitation forecast map correctly.</p>
<p align="center">
    <img src="/images/2023/react-weather-04/01.png" alt="Figure 1"  width="70%">
</p>

<p>Lastly, since we are using Next.js. We may encounter the following error in the console when we direct import <code>WeatherMap</code> component.</p>
<p align="center">
    <img src="/images/2023/react-weather-04/02.png" alt="Figure 2"  width="100%">
</p>

<p>The error mentions that “window is not defined”. This is because we are using Next.js and it provides SSR (server-side rendering) function. When leaflet js attemp to access the global varible <code>window</code> which is only defined when your code run in browser (not SSR). So that, we could use <a target="_blank" rel="noopener" href="https://nextjs.org/docs/pages/building-your-application/optimizing/lazy-loading#with-no-ssr">dynamic import</a> with no ssr to address this issue.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> dynamic <span class="keyword">from</span> <span class="string">&#x27;next/dynamic&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">WeatherMap</span> = <span class="title function_">dynamic</span>(</span><br><span class="line">  <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;your component path&#x27;</span>),</span><br><span class="line">  &#123;<span class="attr">ssr</span>: <span class="literal">false</span>&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>By using the above code, the <code>WeatherMap</code> component will be dynamically imported and rendered without server-side rendering. This resolves the “window is not defined” error.</p>
<p>We could find out more information about this issue via <a target="_blank" rel="noopener" href="https://github.com/PaulLeCam/react-leaflet/issues/956">https://github.com/PaulLeCam/react-leaflet/issues/956</a> It provides additional insights and discussions on how to handle this problem within Next.js.</p>
<blockquote>
<ol>
<li>View full code base of the weather app via my github: <a target="_blank" rel="noopener" href="https://github.com/huyhi/react-weather">react-weather</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/PaulLeCam/react-leaflet/issues/956">React-leaflet Error: window not defined</a></li>
</ol>
</blockquote>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a href="/tags/">Tags</a></li>
        
          <li><a href="/about/">About me</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://huyhi.github.io/2023/react-weather-04/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://huyhi.github.io/2023/react-weather-04/&text=Build a mini weather web with React - 0x04"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://huyhi.github.io/2023/react-weather-04/&title=Build a mini weather web with React - 0x04"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://huyhi.github.io/2023/react-weather-04/&is_video=false&description=Build a mini weather web with React - 0x04"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Build a mini weather web with React - 0x04&body=Check out this article: http://huyhi.github.io/2023/react-weather-04/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://huyhi.github.io/2023/react-weather-04/&title=Build a mini weather web with React - 0x04"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://huyhi.github.io/2023/react-weather-04/&title=Build a mini weather web with React - 0x04"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://huyhi.github.io/2023/react-weather-04/&title=Build a mini weather web with React - 0x04"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://huyhi.github.io/2023/react-weather-04/&title=Build a mini weather web with React - 0x04"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://huyhi.github.io/2023/react-weather-04/&name=Build a mini weather web with React - 0x04&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://huyhi.github.io/2023/react-weather-04/&t=Build a mini weather web with React - 0x04"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2022-2023
    Hongye An
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/tags/">Tags</a></li><!--
     --><!--
       --><li><a href="/about/">About me</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'hongyeblog';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>

<!-- utterances Comments -->

</body>
</html>
